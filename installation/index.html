
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://webvirt.sreejithiv.live/installation/">
      
      
        <link rel="prev" href="../prerequisites/">
      
      
        <link rel="next" href="../configuration/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Installation - WebVirt</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proxmox-and-ldap-base-installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="WebVirt" class="md-header__button md-logo" aria-label="WebVirt" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WebVirt
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Installation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WebVirt" class="md-nav__button md-logo" aria-label="WebVirt" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    WebVirt
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Installation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxmox-and-ldap-base-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Proxmox and LDAP Base Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-ltsp-server-to-use-ldap" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring LTSP server to use LDAP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-configuration-for-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Configuration for Guacamole
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Guacamole
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing Guacamole">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-database-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Database Tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose-setup-for-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Compose Setup for Guacamole
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#completing-the-guacamole-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Completing the Guacamole Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Management
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quirks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quirks
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxmox-and-ldap-base-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Proxmox and LDAP Base Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-ltsp-server-to-use-ldap" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring LTSP server to use LDAP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-configuration-for-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Configuration for Guacamole
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Guacamole
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing Guacamole">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-database-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up Database Tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose-setup-for-guacamole" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Compose Setup for Guacamole
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#completing-the-guacamole-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Completing the Guacamole Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Installation</h1>

<h3 id="proxmox-and-ldap-base-installation">Proxmox and LDAP Base Installation</h3>
<p>Follow the base installation guide for the following before proceeding:</p>
<ul>
<li><a href="https://www.proxmox.com/en/proxmox-virtual-environment/get-started">Proxmox Virtual Environment Installation</a></li>
<li><a href="https://wiki.debian.org/LDAP/OpenLDAPSetup">LDAP Setup on Debian</a></li>
<li><a href="https://ltsp.org/docs/installation/">LTSP Installation (Server side only)</a></li>
</ul>
<h3 id="configuring-ltsp-server-to-use-ldap">Configuring LTSP server to use LDAP</h3>
<p>Since all of our VMs will mount the home directory from the LTSP server, we need to configure the LTSP server to authenticate users from the LDAP server. Run the following commands to install and configure LDAP client on the LTSP server:</p>
<p><div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libpam-ldapd
</code></pre></div>
You will be prompted to enter the LDAP server URI, base DN, etc on a TUI prompt. Enter the details and when you reach the following page, select the following options:</p>
<ol>
<li>passwd</li>
<li>group</li>
<li>shadow</li>
</ol>
<p><img alt="LDAP" src="../assets/Screenshots/LDAP-shadow.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to select the correct options, as selecting the wrong options can cause the server to not authenticate against the LDAP server.</p>
</div>
<p>Now for the final step, we can configure the VM to create a home directory for the user if it doesn't exist. Run the following command:</p>
<p><div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>pam-auth-update
</code></pre></div>
Select the option "Create home directory on login" and click "Ok" like so:</p>
<p><img alt="Home Directory" src="../assets/Screenshots/LDAP-mkhomedir.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Without this option, the server will not create a home directory for the user if it doesn't exist and the user will get dropped to <code>/</code> when they log in.</p>
</div>
<h3 id="ldap-configuration-for-guacamole">LDAP Configuration for Guacamole</h3>
<p>Once LDAP is set up, you need to add a custom schema to store virtual machine information, which Guacamole will use to locate available VMs.</p>
<ol>
<li>
<p>Head over to the Apache Guacamole <a href="https://guacamole.apache.org/releases/1.5.5/">downloads page</a> and find the <code>guacamole-auth-ldap-x.x.x.tar.gz</code> file. The latest version is <code>1.5.5</code> at the time of writing, but download the most recent version available.</p>
</li>
<li>
<p>Extract the tarball. Inside the <code>schema</code> folder, you'll find a file named <code>guacConfigGroup.ldif</code>.</p>
</li>
<li>
<p>Apply this schema to your LDAP instance with the following command:</p>
<div class="highlight"><pre><span></span><code>ldapadd<span class="w"> </span>-Q<span class="w"> </span>-Y<span class="w"> </span>EXTERNAL<span class="w"> </span>-H<span class="w"> </span>ldapi:///<span class="w"> </span>-f<span class="w"> </span>schema/guacConfigGroup.ldif
</code></pre></div>
<p>You may be prompted to enter the LDAP admin password. Upon success, you should see an output like this:</p>
<div class="highlight"><pre><span></span><code>adding new entry &quot;cn=guacConfigGroup,cn=schema,cn=config&quot;
</code></pre></div>
</li>
</ol>
<p>Now that the schema is in place, you're ready to begin adding virtual machines to LDAP. You can do this either manually using LDIF files or via the <a href="https://directory.apache.org/studio/">Apache Directory Studio</a>. This will be covered in the <a href="../management/">Management</a> section.</p>
<h3 id="installing-guacamole">Installing Guacamole</h3>
<p>To deploy Guacamole using Docker, you first need to prepare the necessary database tables.</p>
<h4 id="setting-up-database-tables">Setting Up Database Tables</h4>
<p>Run the following command to launch a temporary Guacamole container that generates SQL scripts for table creation:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>guacamole/guacamole<span class="w"> </span>/opt/guacamole/bin/initdb.sh<span class="w"> </span>--postgresql<span class="w"> </span>&gt;<span class="w"> </span>initdb.sql
</code></pre></div>
<h3 id="docker-compose-setup-for-guacamole">Docker Compose Setup for Guacamole</h3>
<ol>
<li>
<p>Create a <code>compose.yml</code> file for the deployment. Start by defining the PostgreSQL database service:</p>
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamoledb</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:alpine</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">        </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;dontusethispassword&#39;</span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;guacuser&#39;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgdata:/var/lib/postgresql/data</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pgdata</span><span class="p">:</span>
</code></pre></div>
</li>
<li>
<p>Replace the placeholder password with a secure one, then save the file in a folder and run:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>This will start the PostgreSQL container.</p>
</li>
<li>
<p>Copy the generated <code>initdb.sql</code> file to the PostgreSQL container:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>cp<span class="w"> </span>initdb.sql<span class="w"> </span>guacamoledb:/initdb.sql
</code></pre></div>
</li>
<li>
<p>Execute the SQL script inside the container to set up the necessary database tables:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>guacamoledb<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>guacuser<span class="w"> </span>-f<span class="w"> </span>/initdb.sql
</code></pre></div>
</li>
</ol>
<p>Make sure the container name and username match those defined in your <code>compose.yml</code> file.</p>
<h3 id="completing-the-guacamole-setup">Completing the Guacamole Setup</h3>
<p>Stop the currently running database container to add the rest of the configuration:</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>down
</code></pre></div>
Next, append the following services to your existing <code>compose.yml</code> file:</p>
<p><div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">guacd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacd</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole/guacd</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>

<span class="w">  </span><span class="nt">guacamole</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole/guacamole</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:8080</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./guacamole-home:/guacamole-home</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Set Apache Tomcat to use / as the Guacamole web context</span>
<span class="w">      </span><span class="nt">WEBAPP_CONTEXT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ROOT&quot;</span>

<span class="w">      </span><span class="c1"># Directory for custom extensions, duplicated to the container home</span>
<span class="w">      </span><span class="nt">GUACAMOLE_HOME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/guacamole-home&quot;</span>

<span class="w">      </span><span class="nt">GUACD_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacd&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacamoledb&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacuser&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacuser&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dontusethispassword&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_AUTO_CREATE_ACCOUNTS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>

<span class="w">      </span><span class="c1"># LDAP configuration (adjust to match your setup)</span>
<span class="w">      </span><span class="nt">LDAP_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;191.168.111.222&quot;</span>
<span class="w">      </span><span class="nt">LDAP_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">389</span>
<span class="w">      </span><span class="nt">LDAP_USER_BASE_DN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=people,dc=example,dc=com&quot;</span><span class="w"> </span><span class="c1"># Users available for login</span>
<span class="w">      </span><span class="nt">LDAP_CONFIG_BASE_DN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=groups,dc=example,dc=com&quot;</span><span class="w"> </span><span class="c1"># Virtual machines available for use</span>

<span class="w">      </span><span class="c1"># Enable 2FA (if desired)</span>
<span class="w">      </span><span class="c1"># TOTP_ENABLED: &quot;true&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacdb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacd</span>
</code></pre></div>
The final <code>compose.yml</code> file should resemble the following:</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamoledb</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:alpine</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">        </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;dontusethispassword&#39;</span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;guacuser&#39;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgdata:/var/lib/postgresql/data</span>
<span class="w">  </span><span class="nt">guacd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacd</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole/guacd</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>

<span class="w">  </span><span class="nt">guacamole</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacamole/guacamole</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
<span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local&quot;</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8090:8080</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./guacamole-home:/guacamole-home</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">WEBAPP_CONTEXT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ROOT&quot;</span>
<span class="w">      </span><span class="nt">GUACAMOLE_HOME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/guacamole-home&quot;</span>
<span class="w">      </span><span class="nt">GUACD_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacd&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacamoledb&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacuser&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;guacuser&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dontusethispassword&quot;</span>
<span class="w">      </span><span class="nt">POSTGRESQL_AUTO_CREATE_ACCOUNTS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">      </span><span class="nt">LDAP_HOSTNAME</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;191.168.111.222&quot;</span>
<span class="w">      </span><span class="nt">LDAP_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">389</span>
<span class="w">      </span><span class="nt">LDAP_USER_BASE_DN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=people,dc=example,dc=com&quot;</span>
<span class="w">      </span><span class="nt">LDAP_CONFIG_BASE_DN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ou=groups,dc=example,dc=com&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacdb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guacd</span>
<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pgdata</span><span class="p">:</span>
</code></pre></div>
Now you can start the Guacamole services:</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
You will now be able to access Guacamole at <code>http://your-server-ip:8080</code>. If you have a domain name, you can set up a reverse proxy to point to the Guacamole service.</p>
<h2 id="next-steps">Next Steps</h2>
<p>Head over to <a href="../configuration/">Configuration</a> to finalize some more configurations before we can use the system</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>